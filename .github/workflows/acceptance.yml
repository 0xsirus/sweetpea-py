name: Acceptance tests

on: [push, pull_request]

jobs:
  run:
    name: ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
       matrix:
         # NOTE: We explicitly use macOS 10.15 for clarity. As of this writing,
         #       the `macos-latest` runner is just an alias for `macos-10.15`.
         #       Big Sur support is currently in early preview and is not yet
         #       publicly available.
         # TODO: Check back at the following page (under the
         #       `jobs.<job_id>.runs-on` heading) to see if we can update to Big
         #       Sur yet:
         #           https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on
         # NOTE: GitHub Actions currently used amd64 versions of Windows, which
         #       we do not support yet due to unigen-exe not having pre-built
         #       binaries for the platform.
         # TODO: Add tests for Windows when we can support the platform.
         os: [ubuntu-latest, macos-10.15]
         # NOTE: 3.7.9 is the official earliest supported version. We include
         #       3.7 to also test the latest 3.7.x version.
         python-version: ['3.7.9', '3.7', '3.8', '3.9']
    steps:
      - name: Checkout SweetPea
        uses: actions/checkout@v2
        with:
          path: sweetpea
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
      - name: Update pip
        run: pip install --upgrade pip
      - name: Set up SweetPea's Python package dependencies
        run: pip install -r sweetpea/requirements.txt
      - name: Checkout executables
        uses: actions/checkout@v2
        with:
          repository: sweetpea-org/unigen-exe
          path: executables
          ref: v0.1
      - name: Extend $PATH with executables
        run: echo "executables" >> $GITHUB_PATH
      - name: Run acceptance tests
        run: |
          cd sweetpea
          python -m pytest -p no:warnings acceptance
